{"title":"活动中心自测报告","zzzContent":"卖霸活动自测报告:\n\n## 测试说明 ##\n\n\n##数据库字段说明:##\n\n```\n\t活动表: activity_center_activity_info_{0000}\n\tgmt_create 创建时间戳;\n\tgmt_modified,修改时间戳;\n\tname,活动名称\n\tdescription,活动描述;\n\tupstream_id,上游活动ID,追溯用;\n\tindustry_id,所属行业ID,卖霸和算法活动无这个,运营活动是需要运营手工设置的;\n\tact_start_time,活动开始时间\n\tact_end_time, 活动结束时间\n\ttype,类型;1=>算法活动 2=>卖霸活动\n\tstatus,当前状态;1表示正在投放,2表示编辑中,3表示待审批,4表示审批未通过,5表示暂停,6表示已经结束,-1表示已经删除;\n\tpc_url,pc活动页地址,不可为空;\n\twireless_url,无线活动页地址,暂未用到;\n\tdata_source,数据来源,定义为:1=>日常营销活动,2=>招商活动;3=>算法活动;4=>卖家活动;\n\tnids,宝贝ID,算法依赖这个计算投放query和类目,不可为空\n\tseller_id,卖家ID\n\tcategory_ids 计划是保存活动从属的类目,目前没有用到;\n\n 素材表: activity_center_materials_{0000}\n\t\tgmt_create,创建时间戳\n\t\tgmt_modified,修改时间戳\n\t\tactivity_id,活动id\n\t\tpicture_url,图片素材地址\n\t\tpicture_size,图片素材大小,形式如250x500\n\t\taudit_status,审核状态;0 表示待审,1表示审核通过,2表示审核拒绝;\n\t\ttype,(素材类型,暂未用到;@todo)\n\t\tresource_id,资源位ID,到lsrp的是tce_160;\n\t\tstart_time,素材资源位开始时间;素材通过审核时,将素材表的start_time和end_time都设置为和活动的开始结束时间一致;\t未通过审核的素材,start_time 和end_time都保持为0,避免投放上线;\n\t\tend_time,资源位结束时间;\n\t\tstatus,状态:-1表示已经删除;\n```\n\t\n#测试记录:#\n\n## 卖霸活动增量同步测试##\n\n* 测试方法:\n \n\t通过 http://siteadmin.daily.taobao.net/activity/info.html?spm=0.0.0.0.Ql900l&activityTypeId=13 jiangyu06/taobao1234 登录店铺中心后台,创建\"卖霸\"类型的活动,并修改数值,检查mysql数据库中活动表和素材表数据情况;\n\n###卖霸活动的创建和修改标题等字段:###\n\n```\n\t卖霸活动的创建,在insert消息时是没有资源位信息的,只有活动信息;创建活动并选择资源位时,我们也是在收到一条精卫的udpate消息时才做入库处理;\n\t测试创建一个活动,选择两个商品,以下为创建活动时的测试数据:\n\t\t活动标题:黄滚创建活动测试0003\n\t\t活动描述:黄滚创建活动测试0003\n\t\t选中商品:2100502708697,2100504600600 这两个;\n\t\t活动开始时间:2015/10/05 00:00:00 ~ 2015/10/05 12:00:00\n\t\t并上传素材;\n\t通过精卫日志查询,得到已经产生活动id为:211002;\n\t分别通过数据库查询活动和素材信息;\n\t\t活动信息:\n\t\tid:211002\n\t\tgmt_create:2015-09-24 18:11:01\n\t\tgmt_modified:2015-09-24 18:16:19\n\t\tname:黄滚创建活动测试0003\n\t\tdescription:003\n\t\tupstream_id:30704\n\t\tindustry_id:0\n\t\tempid:0\n\t\tnickname:\n\t\tuser_id:\n\t\tact_start_time:1444114800000\n\t\tact_end_time:1444125600000\n\t\tpc_url://shop100107957.daily.taobao.net/yinliubao.htm?activityId=30704\n\t\twireless_url:\n\t\ttype:2\n\t\tstatus:2\n\t\tdata_source:4\n\t\tact_info:\n\t\tseller_id:182153696\n\t\tnids:2100502708697,2100504600600\n\t\tcategory_ids:\n\t\t素材信息:\n\t\tid:38002\n\t\tgmt_create:2015-09-24 18:16:19\n\t\tgmt_modified:2015-09-24 18:16:19\n\t\tactivity_id:211002\n\t\tpicture_url://img.daily.taobaocdn.net/bao/uploaded/i4/TB1nzLMXXXXXXb0XXXXSutbFXXX.jpg\n\t\tpicture_size:250x500\n\t\ttext:\n\t\ttext_length:0\n\t\taudit_status:0\n\t\ttype:0\n\t\tcontent:\n\t\tresource_id:35\n\t\tstart_time:0\n\t\tend_time:0\n\t\tstatus:0\n\t\tpicture_url_ext:\n\t\ttextinfo:\n\t\tqueryid_list:\n```\t\t\n\t\t\n\n\n#### 测试CASE ####\n\n1. 创建一个活动,检查活动是否入库,字段是否正确;活动状态应为2;\n2. 将未发布活动提交发布,活动的状态应由未2变为1;(卖霸的活动是不需要审批的,审批的是素材)\n2. 将活动修改,检查数据库字段是否已经修改;\n3. 增加1个素材,检查新的素材是否入库,活动所属素材总数是否正常;新的素材在未审核通过时,start_time,end_time都应该是0,audit_status也为0;\n4. 素材通过审核,检查数据库里对应素材状态是否修改为1;素材表的start_time和end_time字段应在上线时置为和活动的开始时间和结束时间一致;\n5. 素材被拒绝,检查数据库里对应素材状态是否修改;act_time,end_time应该是0;audit_status为2;\n6. 将活动删除,检查数据库里活动status字段是否成功变为-1\n\n\n####\t测试发现问题:\t####\n\nA. desciption 字段为乱码,原因是上游(店铺中心)发过来的字段值即是乱码,一起发过来的标题(name)是正确的;测试发现修改时是正常的,新建的时候乱码;不影响引擎召回,优先级p3;\nB. 素材类型值未设置;(原因:精卫增量的代码设置不对,待修改;优先级p3);\nC. 资源位ID尚未正确设置,正确的值应该为oe_160,tce_100等值,上游(店铺中心)未正确传过来搜索资源位的值;影响召回,优先级p1 \n\t\t这个和守义沟通,是因为守义还没有拿到所有资源位,因此暂时未传过来;\n目前我在资源位管理系统中添加了LSRP的资源位,该资源位ID为tce_160,资源位类型为\"图\",图片大小为250x500;请 @钟相如(守义)  在日常环境中配置上此资源,并设置资源位ID为\"tce_160\";\n\nD. 资源位初始状态应该为未审核,经过审核通过后再修改为审核通过.目前活动创建后,素材即是审核状态;影响召回,优先级p1\n\t9.25下午和守义重新联调,初始状态不正确这个问题已经修复并验证;需要再分别联调一下审核通过和拒绝的流程;\n\t\t\nE. 删除活动时,发送来的时Update消息,因此未实际下线;(影响活动下线,优先级p0;已经修复)\n\t \t原因分析,精卫发过来的是udpate消息,因此走到了活动修改的逻辑,虽然活动的状态已经是-1了,但是ibatis的sqlmap中没有设置status字段;\n\t    修改措施:在ibatis的udpate语句中将status字段添加上;\n\t    已经处理并测试成功;\nF. 素材修改的代码不成功(原因:activity-materials.xml内容不对,未设置compareValue属性);影响活动审核时的生效,优先级p0;已经修复\n\t\t原因:activity-materials.xml内容不对,未设置compareValue属性;\n\t   修改措施:将设置为isGreaterThan的几个field的compareValue补齐;\n      已经处理并测试成功;\n\n\n#### 其他待测试问题:\n\nMetaQ 精卫发出来的消息是有序的,但是在消费端发生意外时,可能产生重试;因此需要有一个防止更新消息串掉的测试;待联调功能完成后再进行.\n\n\n\t\t\t\t\n## 算法活动测试 ##\n\n算法活动分为两种,一种是正常的每日更新,一种是修正补录;\n\n*每日全量:\n\n 每天会将算法产生的活动信息同步进mysql数据库;对于不存在的信息,会插入新的纪录;对于已经存在的活动信息,会修改活动信息,保持和算法来源的数据一致;对于算法来源已经不存在的活动信息,做逻辑删除处理(活动表status字段置为-1);\n \n*修正补录:\n\n指定一个id区间,将此区间内的所有算法活动在数据库中的字段重新更新一遍(包括素材信息);\n\t\n\t\n*算法活动的数据来自于odps,是通过datax同步到Mysql中去的(表:activity_center_algo_act);因此日常环境无法连接,需要在预发环境测试;\n\n### 算法全量任务测试Case ###\n\n1. 在activity_center_algo_act 中插入一条算法数据;在DST console中触发一次全量任务,检查数据库中是否已经生成对应的活动和素材信息;\n   * 测试成功;\n2. 在activity_center_algo_act 中删除一条算法数据,模拟算法下线活动的情况;在DST console中触发一次全量任务,检查数据库中对应的活动的状态;\n   * 测试成功;\n3. 在activity_center_algo_act表中将一条活动数据的素材地址修改,在DST console中触发一次全量任务,检查活动是否同步地将原有素材标记为删除,并将新素材添加入库;\n   * 测试成功;\n\n### 算法全量任务测试问题 ###\n\n已经测试case的功能测试完毕;\n\n*已经发现问题汇总;* \n\nA. 只有少部分的活动数据能同步过来,大部分活动信息,因为主图字段为空,无法接入到活动中心;\t\n\t原因:上游odps表里的lsrp_pics字段和pic字段均为空值;和影生联系过,原因是近期由于在lsrp不投放算法活动,没有跑计算任务,因此产出活动信息非常少;影生下周会再重新提供一个表;\n\t\t\n\t\t\n","postDate":"2018-01-01 02:03:36","postId":66,"type":"post","status":"publish","imported":false,"file":"活动中心自测报告.md"}